<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.shape.*?>

<BorderPane fx:id="rootPane" prefHeight="600.0" prefWidth="600.0"
            styleClass="recovery-container"
            stylesheets="@../Styles/Common.css,@../Styles/Login.css,@../Styles/PasswordRecovery.css"
            xmlns="http://javafx.com/javafx/8"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="org.example.Controllers.PasswordRecoveryController">

    <center>
        <StackPane alignment="CENTER"> <!-- Using StackPane for layout stability -->
            <VBox fx:id="recoveryForm" alignment="CENTER" spacing="20.0" styleClass="recovery-form">
                <children>
                    <!-- Title -->
                    <Label styleClass="recovery-title" text="RÉCUPÉRATION DE COMPTE">
                        <font>
                            <Font name="System Bold" size="24.0" />
                        </font>
                    </Label>

                    <!-- Step indicator -->
                    <HBox fx:id="stepIndicator" alignment="CENTER" spacing="10.0" styleClass="step-indicator">
                        <Circle fx:id="step1Circle" radius="12" styleClass="step-active" />
                        <Line startX="0" startY="0" endX="30" endY="0" styleClass="step-line" />
                        <Circle fx:id="step2Circle" radius="12" styleClass="step-inactive" />
                        <Line startX="0" startY="0" endX="30" endY="0" styleClass="step-line" />
                        <Circle fx:id="step3Circle" radius="12" styleClass="step-inactive" />
                    </HBox>

                    <!-- Error Message -->
                    <Label fx:id="errorLabel" styleClass="error-label" text="" visible="false" managed="false"/>

                    <!-- Success Message -->
                    <Label fx:id="successLabel" styleClass="success-label" text="" visible="false" managed="false" />

                    <!-- Step 1: Enter Username -->
                    <VBox fx:id="step1Container" spacing="15.0" styleClass="step-container">
                        <Label text="Entrez votre nom d'utilisateur" styleClass="step-label" />
                        <TextField fx:id="usernameField" promptText="Nom d'utilisateur" styleClass="recovery-field" />
                        <Label fx:id="usernameErrorLabel" styleClass="field-error-label" text="" visible="false" managed="false"/>
                        <HBox alignment="CENTER" spacing="10.0">
                            <Button fx:id="cancelButton1" text="Annuler" onAction="#handleCancel" styleClass="cancel-button" />
                            <Button fx:id="nextButton1" text="Suivant" onAction="#handleStep1Next" styleClass="next-button" />
                        </HBox>
                    </VBox>

                    <!-- Step 2: Enter Verification Code -->
                    <VBox fx:id="step2Container" spacing="15.0" styleClass="step-container" visible="false" managed="false">
                        <Label text="Un code de vérification a été envoyé à votre adresse email" styleClass="step-label" />
                        <Label fx:id="emailLabel" text="e***l@example.com" styleClass="email-label" />
                        <HBox alignment="CENTER" spacing="10.0">
                            <TextField fx:id="digit1Field" styleClass="code-field" maxWidth="50" alignment="CENTER" />
                            <TextField fx:id="digit2Field" styleClass="code-field" maxWidth="50" alignment="CENTER" />
                            <TextField fx:id="digit3Field" styleClass="code-field" maxWidth="50" alignment="CENTER" />
                            <TextField fx:id="digit4Field" styleClass="code-field" maxWidth="50" alignment="CENTER" />
                        </HBox>
                        <HBox alignment="CENTER" spacing="10.0">
                            <Button fx:id="resendButton" text="Renvoyer le code" onAction="#handleResendCode" styleClass="resend-button" />
                        </HBox>
                        <HBox alignment="CENTER" spacing="10.0">
                            <Button fx:id="backButton2" text="Retour" onAction="#handleStep2Back" styleClass="back-button" />
                            <Button fx:id="nextButton2" text="Vérifier" onAction="#handleStep2Next" styleClass="next-button" />
                        </HBox>
                    </VBox>

                    <!-- Step 3: Reset Password -->
                    <VBox fx:id="step3Container" spacing="15.0" styleClass="step-container" visible="false" managed="false">
                        <Label text="Créer un nouveau mot de passe" styleClass="step-label" />
                        <PasswordField fx:id="newPasswordField" promptText="Nouveau mot de passe" styleClass="recovery-field" />
                        <Label fx:id="passwordErrorLabel" styleClass="field-error-label" text="" visible="false" managed="false"/>
                        <PasswordField fx:id="confirmPasswordField" promptText="Confirmer le mot de passe" styleClass="recovery-field" />
                        <HBox alignment="CENTER" spacing="10.0">
                            <Button fx:id="backButton3" text="Retour" onAction="#handleStep3Back" styleClass="back-button" />
                            <Button fx:id="resetButton" text="Réinitialiser" onAction="#handlePasswordReset" styleClass="reset-button" />
                        </HBox>
                    </VBox>
                </children>
                <padding>
                    <Insets bottom="40.0" left="40.0" right="40.0" top="40.0" />
                </padding>
            </VBox>
        </StackPane>
    </center>

    <bottom>
        <!-- Footer -->
        <HBox alignment="CENTER" styleClass="login-footer">
            <children>
                <Label text="© 2025 Auto-École Pro | Tous droits réservés" textFill="WHITE" />
            </children>
            <padding>
                <Insets bottom="10.0" top="10.0" />
            </padding>
        </HBox>
    </bottom>
</BorderPane>