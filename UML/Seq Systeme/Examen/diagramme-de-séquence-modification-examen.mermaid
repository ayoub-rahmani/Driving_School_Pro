sequenceDiagram
    actor Utilisateur
    participant IHM as Interface Utilisateur
    participant Ctrl as ExamenController
    participant Svc as ExamenService
    participant Rep as ExamenRep
    participant DB as Base de Données
    participant Audit as AuditLogService

    Utilisateur->>IHM: Sélectionner un examen
    IHM->>Ctrl: examenTable.selectedItemProperty().listener
    Ctrl->>Ctrl: populateForm(selectedExamen)
    Ctrl->>Ctrl: updateExamTypeBadge(examen.getTypeExamen())
    Utilisateur->>IHM: Cliquer sur "Modifier"
    IHM->>Ctrl: handleModifier()
    Ctrl->>Ctrl: disableForm(false)
    Ctrl->>IHM: Activer formulaire
    Utilisateur->>IHM: Modifier les données
    Utilisateur->>IHM: Cliquer sur "Enregistrer"
    IHM->>Ctrl: handleEnregistrer()
    Ctrl->>Ctrl: validateForm()
    alt Validation réussie
        alt Type d'examen = "Conduite"
            Ctrl->>Ctrl: hasCodeExamen(candidatId, dateExamen)
            alt Pas d'examen de code validé
                Ctrl->>IHM: Afficher message d'erreur
            else Examen de code validé
                Ctrl->>Ctrl: Mettre à jour l'objet Examen
                Ctrl->>IHM: Afficher dialogue de confirmation
                Utilisateur->>IHM: Confirmer modification
                Ctrl->>Svc: saveExamen(examen)
                Svc->>Rep: save(examen)
                Rep->>DB: UPDATE examen SET ... WHERE id = ?
                DB->>Rep: Nombre de lignes affectées
                Rep->>Svc: Examen mis à jour
                Svc->>Ctrl: Examen enregistré
                Ctrl->>Audit: logAction("UPDATE", "EXAMEN", id, message)
                Ctrl->>Ctrl: loadExamens()
                Ctrl->>Ctrl: disableForm(true)
                Ctrl->>IHM: Afficher notification de succès
            end
        else Type d'examen = "Code"
            Ctrl->>Ctrl: Mettre à jour l'objet Examen
            Ctrl->>IHM: Afficher dialogue de confirmation
            Utilisateur->>IHM: Confirmer modification
            Ctrl->>Svc: saveExamen(examen)
            Svc->>Rep: save(examen)
            Rep->>DB: UPDATE examen SET ... WHERE id = ?
            DB->>Rep: Nombre de lignes affectées
            Rep->>Svc: Examen mis à jour
            Svc->>Ctrl: Examen enregistré
            Ctrl->>Audit: logAction("UPDATE", "EXAMEN", id, message)
            Ctrl->>Ctrl: loadExamens()
            Ctrl->>Ctrl: disableForm(true)
            Ctrl->>IHM: Afficher notification de succès
        end
    else Validation échouée
        Ctrl->>IHM: Afficher erreurs de validation
    end